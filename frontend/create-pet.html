<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambah Hewan - CarePet</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body
    style="background: radial-gradient(circle at bottom, #1e1e24 0%, #0f172a 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center;">

    <div class="card animate-fade" style="width: 100%; max-width: 550px; padding: 0;">
        <div
            style="padding: 1.5rem; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 1rem;">
            <a href="/dashboard.html" class="btn btn-outline"
                style="padding: 0.4rem; height: 32px; width: 32px; border-radius: 8px;">
                <i data-lucide="arrow-left" size="18"></i>
            </a>
            <h2 style="margin: 0; font-size: 1.25rem;">Tambah Hewan Baru</h2>
        </div>

        <div style="padding: 2rem;">
            <form id="createPetForm">
                <div class="input-group">
                    <label class="label">Nama Hewan</label>
                    <input type="text" id="nama_hewan" class="input" placeholder="Contoh: Mochi" required>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="input-group">
                        <label class="label">Jenis</label>
                        <select id="jenis" class="input" required style="cursor: pointer;">
                            <option value="">Pilih Jenis...</option>
                            <option value="Kucing">Kucing üê±</option>
                            <option value="Anjing">Anjing üê∂</option>
                            <option value="Kelinci">Kelinci üê∞</option>
                            <option value="Lainnya">Lainnya üêæ</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="label">Usia (Tahun)</label>
                        <input type="number" id="usia" class="input" placeholder="0" min="0" required>
                    </div>
                </div>

                <div class="input-group">
                    <label class="label">Kebutuhan Khusus (Opsional)</label>
                    <textarea id="kebutuhan" class="input" placeholder="Apakah ada alergi atau kebiasaan khusus?"
                        rows="3" style="resize: none;"></textarea>
                </div>

                <div id="errorMsg"
                    style="color: var(--danger); font-size: 0.875rem; margin-bottom: 1.5rem; display: none;"></div>

                <div class="flex gap-4" style="margin-top: 2rem;">
                    <a href="/dashboard.html" class="btn btn-outline w-full">Batal</a>
                    <button type="submit" class="btn btn-primary w-full">Simpan Data</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/js/auth.js"></script>
    <script>
        lucide.createIcons();
        if (!auth.getUser()) window.location.href = '/login.html';

        document.getElementById('createPetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nama_hewan = document.getElementById('nama_hewan').value;
            const jenis = document.getElementById('jenis').value;
            const usia = document.getElementById('usia').value;
            const kebutuhan_khusus = document.getElementById('kebutuhan').value;
            const errorDiv = document.getElementById('errorMsg');

            try {
                errorDiv.style.display = 'none';
                const response = await auth.fetch('/pets', {
                    method: 'POST',
                    body: JSON.stringify({ nama_hewan, jenis, usia: parseInt(usia), kebutuhan_khusus })
                });

                if (response.error) throw new Error(response.error);
                window.location.href = '/dashboard.html';

            } catch (err) {
                console.error(err);
                errorDiv.textContent = err.message || "Gagal menyimpan.";
                errorDiv.style.display = 'block';
            }
        });
    </script>
</body>

</html>