<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambah Hewan - CarePet</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">

    <div class="card" style="width: 100%; max-width: 500px;">
        <div style="display: flex; align-items: center; margin-bottom: 2rem; gap: 1rem;">
            <a href="/dashboard.html" class="btn" style="background: var(--bg-dark); padding: 0.5rem;">‚Üê</a>
            <h1 style="font-size: 1.5rem; color: white; margin: 0;">Tambah Hewan Peliharaan</h1>
        </div>

        <form id="createPetForm">
            <div class="form-group">
                <label class="form-label">Nama Hewan</label>
                <input type="text" id="nama_hewan" class="form-input" placeholder="Misal: Mochi" required>
            </div>

            <div class="grid-cols-2" style="gap: 1rem;">
                <div class="form-group">
                    <label class="form-label">Jenis</label>
                    <select id="jenis" class="form-input" required>
                        <option value="">Pilih Jenis</option>
                        <option value="Kucing">Kucing</option>
                        <option value="Anjing">Anjing</option>
                        <option value="Kelinci">Kelinci</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Usia (Tahun)</label>
                    <input type="number" id="usia" class="form-input" placeholder="2" required min="0">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Kebutuhan Khusus (Opsional)</label>
                <textarea id="kebutuhan" class="form-input" placeholder="Misal: Alergi ayam" rows="3"></textarea>
            </div>

            <div id="errorMsg" style="color: #ef4444; font-size: 0.875rem; margin-bottom: 1rem; display: none;"></div>

            <div style="display: flex; gap: 1rem;">
                <button type="button" onclick="window.location.href='/dashboard.html'" class="btn"
                    style="background: var(--bg-dark); color: var(--text-muted); flex: 1;">Batal</button>
                <button type="submit" class="btn btn-primary" style="flex: 1;">Simpan</button>
            </div>
        </form>
    </div>

    <script src="/js/auth.js"></script>
    <script>
        // Auth Guard
        if (!auth.getUser()) {
            window.location.href = '/login.html';
        }

        document.getElementById('createPetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nama_hewan = document.getElementById('nama_hewan').value;
            const jenis = document.getElementById('jenis').value;
            const usia = document.getElementById('usia').value;
            const kebutuhan_khusus = document.getElementById('kebutuhan').value;
            const errorDiv = document.getElementById('errorMsg');

            try {
                errorDiv.style.display = 'none';
                // Using auth.fetch to make authenticated request
                const response = await auth.fetch('/pets', {
                    method: 'POST',
                    body: JSON.stringify({ nama_hewan, jenis, usia: parseInt(usia), kebutuhan_khusus })
                });

                // auth.fetch returns the JSON response, but doesn't throw on error status unless we handle it in auth.js
                // In auth.js I only handled 401. If update failed (e.g. 500) it might return {error: ...}
                // Let's check if response has 'id' or 'message'
                if (response.error) {
                    throw new Error(response.error);
                }

                window.location.href = '/dashboard.html';

            } catch (err) {
                console.error(err);
                errorDiv.textContent = err.message || "Gagal menambah hewan.";
                errorDiv.style.display = 'block';
            }
        });
    </script>
</body>

</html>